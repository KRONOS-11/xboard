(function() {

/**
 * =============
 *    Helpers
 * =============
 */

/* Calls functions by their name and arguments. Used in canvasFunction
   which is a wrapper around all drawing functions and the interface to XB
   from XBUI. */
function executeFunctionByName(functionName, context /*, args */) {
  var args = Array.prototype.slice.call(arguments, 2);
  var namespaces = functionName.split(".");
  var func = namespaces.pop();
  for (var i = 0; i < namespaces.length; i++) {
      context = context[namespaces[i]];
  }
  return context[func].apply(context, args);
}

// LZW-compress a string
function lzw_encode(s) {
    var dict = {};
    var data = (s + "").split("");
    var out = [];
    var currChar;
    var phrase = data[0];
    var code = 256;
    for (var i=1; i<data.length; i++) {
        currChar=data[i];
        if (dict[phrase + currChar] != null) {
            phrase += currChar;
        }
        else {
            out.push(phrase.length > 1 ? dict[phrase] : phrase.charCodeAt(0));
            dict[phrase + currChar] = code;
            code++;
            phrase=currChar;
        }
    }
    out.push(phrase.length > 1 ? dict[phrase] : phrase.charCodeAt(0));
    for (var i=0; i<out.length; i++) {
        out[i] = String.fromCharCode(out[i]);
    }
    return out.join("");
}

// Decompress an LZW-encoded string
function lzw_decode(s) {
    var dict = {};
    var data = (s + "").split("");
    var currChar = data[0];
    var oldPhrase = currChar;
    var out = [currChar];
    var code = 256;
    var phrase;
    for (var i=1; i<data.length; i++) {
        var currCode = data[i].charCodeAt(0);
        if (currCode < 256) {
            phrase = data[i];
        }
        else {
           phrase = dict[currCode] ? dict[currCode] : (oldPhrase + currChar);
        }
        out.push(phrase);
        currChar = phrase.charAt(0);
        dict[code] = oldPhrase + currChar;
        code++;
        oldPhrase = phrase;
    }
    return out.join("");
}

/**
 * =============
 *     MODEL
 * =============
 */

/* === BEGIN Event objects === */
/* Begin path event */
function BeginPath(x, y) {
  this.coord = [x, y];
  this.type="b";
  this.time = XB.getRecordingTime();
  console.log("Begin path: "+this.time);
}

/* End path event */
function ClosePath() {
  this.type = "c";
  this.time = XB.getRecordingTime();
  console.log("Close path: "+this.time);
}

/* Point draw event */
function DrawPathToPoint(x, y) {
  this.type = "d";
  this.coord = [x, y];
  this.time = XB.getRecordingTime();
}

/*Erase event */
function Erase(x, y) {
  this.type = "e";
  this.coord = [x, y];
  this.height = 10;
  this.width = 10;
  this.time = XB.getRecordingTime();
}

/* Stroke style event
   Don't want this to take up time, so we set it as last
   event before recording ended. Delays should only be on
   drawing events */
function StrokeStyle(color) {
  this.type = "s";
  this.color = color;
  console.log("Color: " + color);
  if (XB.recording) {
    this.time = XB.getRecordingTime();
  } else {
    this.time = XB.lastEndTime - XB.subtractTime;
  }
}
/* === END Event objects === */



/**
 * ====================
 *    STATIC CONTROL
 * ====================
 */
window.XB = {

    context: null,
    canvas: null,
    type: '',
    coord: [0,0],
    events: [],
    animIndex: 0, // next in queue
    recording: false,
    recordingTime: 0,
    lastEndTime: 0,
    subtractTime: 0,
    recordClockInterval: null,
    playbackClockTimeout: null,
    playbackClock: 0,
    isPlaying: false,
    sampleRate: 250, // ms increments for clock intervals
    animateTimeout: null,
    drawColor: '#000000',

    /**
     * Initializes the script by setting the default
     * values for parameters of the class.
     *
     * @param canvasid The id of the canvas element used
     */
    init: function(canvasid) {
      // set the canvas width and height
      // the offsetWidth and Height is default width and height
      this.canvas = document.getElementById(canvasid);
      this.canvas.width = this.canvas.offsetWidth;
      this.canvas.height = this.canvas.offsetHeight;

      //console.log(this.canvas);
      this.context = this.canvas.getContext('2d');

      //initial values for the drawing context
      this.context.lineWidth = 5;
      this.context.lineCap = "square";

      // Initialize the selected color and add it as the first event
      XB.setStrokeStyle(XB.drawColor);
    },

    /**
     * Executes the event that matches the given event
     * object
     *
     * @param xbevent The event object to be executed.
     * @param firstexecute tells the function if the event is new and
     *          should be saved to this.events
     * This object should be one of the model's event objects.
     */
    //execute: function(xbevent, firstexecute) {
    execute: function(xbevent){
      var type = xbevent.type;
      var wid;
      var hei;
      var tmp;

      // Only push and save if we're recording
      if (XB.recording){
        XB.events.push(xbevent);
      }

      if(type === "b") {
        this.context.beginPath();
        this.context.moveTo(xbevent.coord[0],
                       xbevent.coord[1]);
        this.context.stroke();
      } else if (type === "d") {
        this.context.lineTo(xbevent.coord[0],
                       xbevent.coord[1]);
        this.context.stroke();
      } else if (type === "c") {
        this.context.closePath();
      } else if(type === "s") {
        this.context.strokeStyle = xbevent.color;
      } else if (type === "e") {
        this.context.clearRect(xbevent.coord[0],
                               xbevent.coord[1],
                               xbevent.width,
                               xbevent.height);
        }

    },


    /**
     * Resolves the relative width and height of the canvas
     * element. Relative parameters can vary depending on the
     * zoom. Both are equal to 1 if no zoom is encountered.
     *
     * @return An array containing the relative width as first
     * element and relative height as second.
     */
    getRelative: function() {
      return {width: this.canvas.width/this.canvas.offsetWidth,
          height: this.canvas.height/this.canvas.offsetHeight};
    },

    /* === BEGIN ACTIONS === */

    /**
     * Starts the animation action in the canvas from start. This clears
     * the whole canvas and starts to execute actions from
     * the action stack by calling XB.animateNext().
     * Will reset playback clock as well.
     */
    animate: function() {
      console.log("--- playing from beginning");
      XB.setPlaybackClock(0);
      XB.animIndex = 0;
      XB.context.clearRect(0,0,XB.canvas.width,XB.canvas.height);
      if (XB.events.length > 0) {
        XB.animateNext(XB.events[0].time);
      }
    },

    /**
     * This function animates the next event in the event
     * stack and waits for the amount of time between the
     * current and next event before calling itself again.
     * If a time argument is passed in, it is essentially a
     * delay on the calling of the function. It calls itself
     * again by setting a timeout.
     */
    animateNext: function(delay) {
      if (!(typeof delay === "undefined")) {
        XB.animateTimeout = setTimeout(XB.animateNext);
      } else {
        if (XB.animIndex === 0) {
          XB.animateTimeout = setTimeout(function(){
            XB.execute(XB.events[0]);
          }, XB.events[0].time);
        } else {
          XB.execute(XB.events[XB.animIndex]);
        }
        XB.animIndex++;
        if (XB.animIndex < XB.events.length - 1) {
          var diffTime = XB.events[XB.animIndex].time - XB.events[XB.animIndex - 1].time;
          XB.animateTimeout = setTimeout(XB.animateNext, diffTime);
        } else {
          // we've reached the end, decrement back down
          XB.animIndex--;
        }
      }
    },


    /* called when someone clicks or moves the scrubber */
    jump: function(time){
      XB.redraw(time);
      // stop the old playbackClockTimeout and start a new one at our new time
      clearTimeout(XB.playbackClockTimeout);
      XB.setPlaybackClock(time);
      if (XB.isPlaying) {
        XB.animateNext(XB.events[XB.animIndex].time - time);
      }
    },

    // stops playback and playback clock
    pause: function(){
      XB.isPlaying = false;
      // could be redundant if we already cleared timeout at end of playback, but
      // that's ok
      clearTimeout(XB.animateTimeout);
      clearTimeout(XB.playbackClockTimeout);
      console.log("--- paused");
    },

    // start clock again and continue animating from the proper index.
    play: function(){
      console.log("--- playing at ind: " + XB.animIndex);
      XB.isPlaying = true;
      if (XB.playbackEnd()) {
        XB.animate();
      } else {
        XB.setPlaybackClock();

        // only animate if we haven't played all the events yet
        if (!XB.eventsEnd()){
          console.log("Ind: " + XB.animIndex + " End: " + XB.events.length);
          XB.animateNext(XB.events[XB.animIndex].time - XB.playbackClock);
        }
      }
    },


    record: function(){
      // if in middle of playback and you record, go back to the end of the
      // recording, only supporting appending for records
      if (!XB.playbackEnd()) {
        XB.redraw();
      }
      XB.recording = true;
      XB.subtractTime += (new Date().getTime() - XB.lastEndTime);
      console.log("record, subtractTime: "+ XB.subtractTime);
      XBUI.setClockInterval();
    },

    pauseRecord: function(){
      console.log("XB.pauseRecord ----------");
      XB.recording = false;
      // keep track of this to make one smooth timeline even if we stop
      // and start recording sporadically.
      XB.lastEndTime = new Date().getTime();
      // playback clock should be same as recording time when we stop recording
      XB.playbackClock = XB.getRecordingTime();
      clearInterval(XB.recordClockInterval);
    },

    /**
     * Begins a drawing path.
     *
     * @param x Coordinate x of the path starting point
     * @param y Coordinate y of the path starting point
     */
    beginPencilDraw: function(x, y) {
      var e = new BeginPath(x, y);
      XB.execute(e);
    },

    endPencilDraw: function(){
      var e = new ClosePath();
      XB.execute(e);
    },

    /**
     * Draws a path from the path starting point to the
     * point indicated by the given parameters.
     *
     * @param x Coordinate x of the path ending point
     * @param y Coordinate y of the path ending point
     */
    pencilDraw: function(x, y) {
        var e = new DrawPathToPoint(x, y);
        XB.execute(e);
    },

    /**
     * Begins erasing path.
     *
     * @param x Coordinate x of the path starting point
     * @param y Coordinate y of the path starting point
     */
    beginErasing: function(x, y) {
        var e = new BeginPath(x, y);
        XB.execute(e);
    },

    /**
     * Erases the point indicated by the given coordinates.
     * Actually this doesn't take the path starting point
     * into account but erases a rectangle at the given
     * coordinates with width and height specified in the
     * Erase object.
     *
     * @param x Coordinate x of the path ending point
     * @param y Coordinate y of the path ending point
     */
    erasePoint: function(x, y) {
        var e = new Erase(x, y);
        XB.execute(e);
    },

    /**
     * This function redraws the entire canvas
     * according to the events in events.
     * If a time is specified it only redraws up to that point. Otherwise it
     * redraws the entire canvas.
    */
    redraw: function(time) {
      // Only redraw the entire board if we're going backwards from our current state
      if (!(typeof time === "undefined" || time >= XB.playbackClock)) {
        XB.animIndex = 0;
        XB.context.clearRect(0,0,XB.canvas.width,XB.canvas.height);
      }
      // This code is verbose, but better for performance by reducing the number
      // of conditions checked in the loop
      if (typeof time === "undefined") {
        for (XB.animIndex; XB.animIndex < XB.events.length; XB.animIndex++){
          XB.execute(XB.events[XB.animIndex]);
        }
      } else { //redraw only up to time
        for (XB.animIndex; XB.animIndex < XB.events.length; XB.animIndex++){
          if (XB.events[XB.animIndex].time >= time){
            break;
          } else {
            XB.execute(XB.events[XB.animIndex]);
          }
        }
      }

      // If we got to the end, our animIndex is out of bounds now, decrement
      if (XB.animIndex == XB.events.length) {
        XB.animIndex--;
      }
    },

   /**
     * Sets stroke style for the canvas. Stroke
     * style defines the color with which every
     * stroke should be drawn on the canvas.
     *
     * @param color The wanted stroke color
    */
    setStrokeStyle: function(color) {
      console.log(color);
      var e = new StrokeStyle(color);
      XB.execute(e);
      // Always push changes in stroke style if not playing
      // Push here, not in execute, because then redraw would
      // be pushing StrokeStyle events into XB.events.
      if (!XB.isPlaying) {
        XB.events.push(e);
      }
    },

    /* === END ACTIONS === */

    /**
     * Wrapper around drawing functions, we want to make sure
     * recording is on first before anything gets executed.
     */
    canvasFunction: function(function_name, x, y){
      if (XB.recording) {
        executeFunctionByName(function_name, XB, x, y);
      }
    },

    // Compresses event data using CJSON
    // Also stores meta-data, time
    save: function(){
      var data = {
        'recordingTime': XB.getRecordingTime(),
        'subtractTime': XB.subtractTime,
        'lastEndTime' : XB.lastEndTime,
        'strokeColor' : XB.context.strokeStyle,
        'events': XB.events
      };
      console.log("json --: " + JSON.stringify(data).length);
      console.log("cjson--: " + CJSON.stringify(data).length);
      console.log("lzwjson: " + lzw_encode(JSON.stringify(data)).length);
      console.log("lzwcjso: " + lzw_encode(CJSON.stringify(data)).length);
      data = lzw_encode(CJSON.stringify(data));
    },

    // Restores the state of the canvas from saved compressed data
    restore: function(uniqueID){
      //XB.events = CJSON.parse();
      // set max slider time
      // sync endtime/subtractTime
      var storedData;
      if (uniqueID == "something1234") {
      } else {
        storedData='{"f":"cjson","t":[[0,"type"],[1,"time"],[1,"color","time"],[1,"coord","time"],[0,"coord","type","time"],[0,"recordingTime","subtractTime","lastEndTime","strokeColor","events"]],"v":{"":[6,35393,1336683425863,1336683461308,"#008080",[{"":[3,"s","#000000",0]},{"":[5,[206,116],"b",208]},{"":[4,"d",[204,116],222]},{"":[4,"d",[200,118],239]},{"":[4,"d",[191,128],256]},{"":[4,"d",[175,140],272]},{"":[4,"d",[164,149],289]},{"":[4,"d",[158,153],305]},{"":[4,"d",[158,155],322]},{"":[4,"d",[163,156],339]},{"":[4,"d",[196,156],356]},{"":[4,"d",[253,154],372]},{"":[4,"d",[295,149],389]},{"":[4,"d",[310,149],405]},{"":[4,"d",[312,149],439]},{"":[4,"d",[296,165],455]},{"":[4,"d",[257,198],472]},{"":[4,"d",[217,235],490]},{"":[4,"d",[198,257],506]},{"":[4,"d",[193,265],523]},{"":[4,"d",[193,270],543]},{"":[4,"d",[194,273],560]},{"":[4,"d",[202,276],577]},{"":[2,"c",578]},{"":[5,[326,205],"b",1112]},{"":[4,"d",[325,203],1137]},{"":[4,"d",[319,205],1154]},{"":[4,"d",[299,214],1170]},{"":[4,"d",[270,239],1187]},{"":[4,"d",[250,266],1204]},{"":[4,"d",[242,295],1220]},{"":[4,"d",[242,309],1237]},{"":[4,"d",[246,316],1253]},{"":[4,"d",[262,317],1269]},{"":[4,"d",[276,317],1287]},{"":[4,"d",[287,315],1303]},{"":[4,"d",[282,317],1353]},{"":[4,"d",[276,324],1370]},{"":[4,"d",[274,333],1387]},{"":[4,"d",[273,337],1404]},{"":[4,"d",[275,339],1420]},{"":[4,"d",[276,339],1436]},{"":[4,"d",[282,338],1453]},{"":[4,"d",[292,333],1469]},{"":[4,"d",[299,325],1487]},{"":[4,"d",[304,316],1503]},{"":[4,"d",[305,307],1519]},{"":[4,"d",[305,302],1537]},{"":[4,"d",[303,299],1553]},{"":[4,"d",[295,292],1570]},{"":[4,"d",[281,288],1587]},{"":[4,"d",[267,287],1604]},{"":[4,"d",[250,290],1620]},{"":[4,"d",[245,297],1637]},{"":[4,"d",[244,299],1653]},{"":[4,"d",[249,299],1671]},{"":[4,"d",[275,291],1687]},{"":[4,"d",[303,270],1703]},{"":[4,"d",[318,246],1720]},{"":[4,"d",[324,224],1737]},{"":[4,"d",[324,209],1753]},{"":[4,"d",[320,203],1776]},{"":[4,"d",[308,200],1793]},{"":[4,"d",[292,200],1809]},{"":[4,"d",[278,213],1826]},{"":[2,"c",1828]},{"":[3,"s","rgb(153, 204, 0)",3899]},{"":[3,"s","rgb(153, 204, 0)",3899]},{"":[5,[482,88],"b",4735]},{"":[4,"d",[478,91],4748]},{"":[4,"d",[469,100],4765]},{"":[4,"d",[458,109],4781]},{"":[4,"d",[449,118],4798]},{"":[4,"d",[439,132],4818]},{"":[4,"d",[435,147],4835]},{"":[4,"d",[437,159],4853]},{"":[4,"d",[444,173],4870]},{"":[4,"d",[455,181],4885]},{"":[4,"d",[459,184],4903]},{"":[4,"d",[460,185],4919]},{"":[4,"d",[460,187],4935]},{"":[4,"d",[455,194],4953]},{"":[4,"d",[433,208],4970]},{"":[4,"d",[408,228],4986]},{"":[4,"d",[394,242],5003]},{"":[4,"d",[389,251],5019]},{"":[4,"d",[388,256],5036]},{"":[4,"d",[388,262],5054]},{"":[4,"d",[388,265],5070]},{"":[4,"d",[388,269],5086]},{"":[4,"d",[384,272],5103]},{"":[4,"d",[371,275],5119]},{"":[4,"d",[353,275],5136]},{"":[4,"d",[334,275],5154]},{"":[4,"d",[311,273],5170]},{"":[4,"d",[297,267],5186]},{"":[4,"d",[284,251],5204]},{"":[4,"d",[281,222],5221]},{"":[4,"d",[284,187],5237]},{"":[4,"d",[286,148],5253]},{"":[4,"d",[291,106],5269]},{"":[4,"d",[291,80],5287]},{"":[4,"d",[291,73],5303]},{"":[4,"d",[288,75],5365]},{"":[4,"d",[280,81],5382]},{"":[4,"d",[269,89],5399]},{"":[2,"c",5408]},{"":[5,[272,67],"b",5583]},{"":[4,"d",[262,67],5600]},{"":[4,"d",[227,67],5615]},{"":[4,"d",[196,71],5632]},{"":[4,"d",[167,80],5648]},{"":[4,"d",[149,91],5666]},{"":[4,"d",[143,99],5682]},{"":[4,"d",[139,108],5699]},{"":[4,"d",[138,115],5721]},{"":[4,"d",[142,124],5737]},{"":[4,"d",[151,133],5754]},{"":[4,"d",[170,141],5770]},{"":[4,"d",[186,145],5787]},{"":[4,"d",[193,148],5804]},{"":[4,"d",[193,150],5820]},{"":[4,"d",[193,155],5837]},{"":[4,"d",[188,162],5854]},{"":[4,"d",[180,175],5870]},{"":[4,"d",[170,188],5887]},{"":[4,"d",[159,206],5905]},{"":[4,"d",[145,229],5921]},{"":[4,"d",[131,247],5937]},{"":[4,"d",[127,258],5955]},{"":[2,"c",5972]},{"":[5,[49,286],"b",6118]},{"":[4,"d",[44,288],6133]},{"":[4,"d",[39,290],6149]},{"":[4,"d",[38,292],6174]},{"":[4,"d",[37,295],6187]},{"":[4,"d",[36,298],6205]},{"":[4,"d",[36,303],6224]},{"":[4,"d",[37,307],6238]},{"":[4,"d",[45,314],6257]},{"":[4,"d",[62,327],6271]},{"":[2,"c",6274]},{"":[5,[199,351],"b",6334]},{"":[4,"d",[219,351],6355]},{"":[4,"d",[231,351],6378]},{"":[4,"d",[238,352],6390]},{"":[4,"d",[244,354],6407]},{"":[4,"d",[251,355],6424]},{"":[4,"d",[260,355],6441]},{"":[4,"d",[275,352],6457]},{"":[4,"d",[299,345],6474]},{"":[2,"c",6476]},{"":[5,[328,339],"b",6514]},{"":[4,"d",[341,336],6516]},{"":[4,"d",[350,335],6545]},{"":[4,"d",[356,331],6550]},{"":[4,"d",[361,329],6578]},{"":[4,"d",[367,325],6591]},{"":[4,"d",[377,317],6607]},{"":[2,"c",6625]},{"":[5,[442,271],"b",6687]},{"":[4,"d",[445,261],6699]},{"":[4,"d",[446,239],6716]},{"":[4,"d",[447,215],6733]},{"":[4,"d",[447,186],6758]},{"":[4,"d",[428,146],6775]},{"":[4,"d",[404,98],6792]},{"":[4,"d",[383,65],6808]},{"":[4,"d",[365,48],6825]},{"":[4,"d",[352,38],6843]},{"":[4,"d",[338,35],6859]},{"":[4,"d",[313,34],6875]},{"":[4,"d",[290,34],6892]},{"":[4,"d",[273,37],6909]},{"":[4,"d",[250,43],6926]},{"":[2,"c",6927]},{"":[5,[205,72],"b",7015]},{"":[4,"d",[199,78],7016]},{"":[4,"d",[191,86],7033]},{"":[4,"d",[181,93],7059]},{"":[4,"d",[169,98],7076]},{"":[4,"d",[161,100],7088]},{"":[4,"d",[148,101],7110]},{"":[2,"c",7111]},{"":[5,[118,118],"b",7183]},{"":[4,"d",[112,127],7200]},{"":[4,"d",[108,138],7220]},{"":[4,"d",[106,149],7244]},{"":[4,"d",[103,163],7255]},{"":[4,"d",[101,174],7277]},{"":[2,"c",7281]},{"":[5,[162,232],"b",7335]},{"":[4,"d",[192,250],7359]},{"":[4,"d",[235,274],7375]},{"":[4,"d",[259,285],7395]},{"":[4,"d",[270,292],7407]},{"":[4,"d",[281,296],7428]},{"":[4,"d",[289,300],7444]},{"":[4,"d",[306,306],7461]},{"":[2,"c",7465]},{"":[5,[345,317],"b",7518]},{"":[4,"d",[349,321],7534]},{"":[4,"d",[361,327],7551]},{"":[4,"d",[373,333],7567]},{"":[4,"d",[385,336],7585]},{"":[4,"d",[390,338],7600]},{"":[4,"d",[401,341],7617]},{"":[2,"c",7629]},{"":[5,[474,339],"b",7702]},{"":[4,"d",[477,334],7728]},{"":[4,"d",[481,320],7739]},{"":[4,"d",[484,299],7766]},{"":[4,"d",[485,279],7767]},{"":[4,"d",[485,254],7796]},{"":[2,"c",7798]},{"":[5,[464,131],"b",7871]},{"":[4,"d",[452,110],7886]},{"":[4,"d",[447,98],7900]},{"":[4,"d",[441,89],7927]},{"":[4,"d",[435,79],7939]},{"":[4,"d",[425,63],7962]},{"":[4,"d",[404,44],7979]},{"":[4,"d",[379,33],7996]},{"":[2,"c",7998]},{"":[5,[315,25],"b",8066]},{"":[4,"d",[309,25],8067]},{"":[4,"d",[299,25],8086]},{"":[4,"d",[291,25],8118]},{"":[4,"d",[285,27],8134]},{"":[4,"d",[275,29],8158]},{"":[2,"c",8174]},{"":[5,[212,47],"b",8231]},{"":[4,"d",[201,53],8234]},{"":[4,"d",[191,62],8264]},{"":[4,"d",[173,76],8286]},{"":[4,"d",[166,83],8311]},{"":[4,"d",[162,85],8331]},{"":[2,"c",8350]},{"":[5,[128,105],"b",8410]},{"":[4,"d",[126,107],8418]},{"":[4,"d",[119,114],8440]},{"":[4,"d",[114,120],8466]},{"":[4,"d",[111,128],8467]},{"":[4,"d",[107,138],8489]},{"":[4,"d",[105,147],8506]},{"":[2,"c",8524]},{"":[5,[116,202],"b",8599]},{"":[4,"d",[124,211],8601]},{"":[4,"d",[130,218],8629]},{"":[4,"d",[149,241],8654]},{"":[4,"d",[155,248],8674]},{"":[4,"d",[164,255],8689]},{"":[4,"d",[169,259],8706]},{"":[2,"c",8708]},{"":[5,[198,277],"b",8775]},{"":[4,"d",[223,285],8784]},{"":[4,"d",[241,289],8801]},{"":[4,"d",[265,297],8818]},{"":[4,"d",[278,301],8834]},{"":[4,"d",[288,303],8851]},{"":[4,"d",[302,307],8868]},{"":[4,"d",[314,310],8884]},{"":[2,"c",8896]},{"":[5,[381,319],"b",8967]},{"":[4,"d",[394,322],8968]},{"":[4,"d",[411,322],8987]},{"":[4,"d",[420,322],9010]},{"":[4,"d",[430,320],9026]},{"":[4,"d",[434,316],9039]},{"":[4,"d",[437,313],9056]},{"":[4,"d",[446,300],9071]},{"":[4,"d",[457,279],9090]},{"":[4,"d",[464,264],9105]},{"":[4,"d",[470,247],9122]},{"":[4,"d",[473,229],9139]},{"":[4,"d",[473,209],9156]},{"":[2,"c",9173]},{"":[5,[428,135],"b",9302]},{"":[4,"d",[418,135],9318]},{"":[4,"d",[406,137],9337]},{"":[4,"d",[383,144],9351]},{"":[4,"d",[361,149],9369]},{"":[4,"d",[339,153],9385]},{"":[4,"d",[316,157],9402]},{"":[4,"d",[288,164],9418]},{"":[4,"d",[245,172],9435]},{"":[4,"d",[96,202],9534]},{"":[4,"d",[108,206],9569]},{"":[4,"d",[150,220],9585]},{"":[4,"d",[234,240],9599]},{"":[4,"d",[312,248],9616]},{"":[4,"d",[342,252],9632]},{"":[4,"d",[352,255],9650]},{"":[4,"d",[352,256],9666]},{"":[4,"d",[352,259],9683]},{"":[4,"d",[351,262],9699]},{"":[4,"d",[341,269],9717]},{"":[4,"d",[317,277],9733]},{"":[4,"d",[288,287],9754]},{"":[4,"d",[273,292],9770]},{"":[4,"d",[266,295],9788]},{"":[4,"d",[282,296],9849]},{"":[4,"d",[319,302],9866]},{"":[4,"d",[383,306],9882]},{"":[4,"d",[430,309],9899]},{"":[4,"d",[443,311],9916]},{"":[4,"d",[444,312],9949]},{"":[4,"d",[436,313],9966]},{"":[4,"d",[402,317],9982]},{"":[4,"d",[331,317],10000]},{"":[4,"d",[273,315],10016]},{"":[4,"d",[216,314],10033]},{"":[4,"d",[202,313],10051]},{"":[4,"d",[199,312],10066]},{"":[4,"d",[199,311],10099]},{"":[4,"d",[199,310],10132]},{"":[4,"d",[200,307],10150]},{"":[4,"d",[204,304],10166]},{"":[4,"d",[215,295],10183]},{"":[4,"d",[234,282],10199]},{"":[4,"d",[258,267],10217]},{"":[4,"d",[284,249],10232]},{"":[4,"d",[316,234],10254]},{"":[4,"d",[331,227],10271]},{"":[4,"d",[335,224],10288]},{"":[4,"d",[337,222],10304]},{"":[4,"d",[337,221],10332]},{"":[4,"d",[333,220],10349]},{"":[4,"d",[292,214],10366]},{"":[4,"d",[216,202],10382]},{"":[4,"d",[157,197],10401]},{"":[4,"d",[139,197],10416]},{"":[4,"d",[155,194],10449]},{"":[4,"d",[167,193],10467]},{"":[4,"d",[200,190],10483]},{"":[4,"d",[242,187],10499]},{"":[4,"d",[294,180],10516]},{"":[4,"d",[324,171],10533]},{"":[4,"d",[336,164],10550]},{"":[4,"d",[340,158],10566]},{"":[4,"d",[340,150],10582]},{"":[4,"d",[336,139],10600]},{"":[4,"d",[328,123],10616]},{"":[4,"d",[314,101],10633]},{"":[4,"d",[295,82],10650]},{"":[4,"d",[285,74],10666]},{"":[4,"d",[275,74],10682]},{"":[4,"d",[267,77],10699]},{"":[4,"d",[257,91],10716]},{"":[4,"d",[245,123],10733]},{"":[4,"d",[239,160],10755]},{"":[4,"d",[236,193],10772]},{"":[4,"d",[236,218],10789]},{"":[4,"d",[236,234],10806]},{"":[4,"d",[237,245],10823]},{"":[4,"d",[238,254],10838]},{"":[4,"d",[238,261],10856]},{"":[4,"d",[237,257],10900]},{"":[4,"d",[233,232],10916]},{"":[4,"d",[226,194],10933]},{"":[4,"d",[202,143],10949]},{"":[4,"d",[173,99],10966]},{"":[4,"d",[144,71],10983]},{"":[4,"d",[138,70],11000]},{"":[4,"d",[136,72],11033]},{"":[4,"d",[136,83],11050]},{"":[4,"d",[136,104],11067]},{"":[4,"d",[136,137],11083]},{"":[4,"d",[133,179],11100]},{"":[4,"d",[129,217],11117]},{"":[4,"d",[127,237],11134]},{"":[4,"d",[127,247],11149]},{"":[4,"d",[127,252],11167]},{"":[4,"d",[127,254],11183]},{"":[4,"d",[127,257],11200]},{"":[4,"d",[126,258],11216]},{"":[4,"d",[126,223],11284]},{"":[4,"d",[129,184],11300]},{"":[4,"d",[134,159],11317]},{"":[4,"d",[134,146],11333]},{"":[4,"d",[134,140],11350]},{"":[4,"d",[134,138],11366]},{"":[4,"d",[132,137],11383]},{"":[4,"d",[128,138],11400]},{"":[4,"d",[122,152],11416]},{"":[4,"d",[112,177],11433]},{"":[4,"d",[105,216],11450]},{"":[4,"d",[100,256],11467]},{"":[4,"d",[98,280],11483]},{"":[4,"d",[95,299],11500]},{"":[4,"d",[95,309],11516]},{"":[4,"d",[94,312],11533]},{"":[4,"d",[94,313],11550]},{"":[4,"d",[94,312],11600]},{"":[4,"d",[92,298],11617]},{"":[4,"d",[85,260],11634]},{"":[4,"d",[84,208],11650]},{"":[4,"d",[83,156],11667]},{"":[4,"d",[83,99],11683]},{"":[4,"d",[83,71],11700]},{"":[4,"d",[84,65],11717]},{"":[4,"d",[86,66],11750]},{"":[4,"d",[86,71],11767]},{"":[4,"d",[93,102],11784]},{"":[4,"d",[98,136],11800]},{"":[4,"d",[103,174],11817]},{"":[4,"d",[109,219],11834]},{"":[4,"d",[117,252],11850]},{"":[4,"d",[121,261],11867]},{"":[4,"d",[125,261],11883]},{"":[4,"d",[128,261],11900]},{"":[4,"d",[135,262],11917]},{"":[4,"d",[152,263],11934]},{"":[4,"d",[170,261],11950]},{"":[4,"d",[195,248],11968]},{"":[4,"d",[229,231],11984]},{"":[4,"d",[266,222],12000]},{"":[4,"d",[313,222],12027]},{"":[4,"d",[366,231],12043]},{"":[4,"d",[397,241],12060]},{"":[4,"d",[410,245],12077]},{"":[4,"d",[416,251],12094]},{"":[4,"d",[416,260],12110]},{"":[4,"d",[414,272],12127]},{"":[4,"d",[412,276],12144]},{"":[4,"d",[406,284],12160]},{"":[4,"d",[397,289],12177]},{"":[4,"d",[359,289],12195]},{"":[4,"d",[301,279],12209]},{"":[4,"d",[243,274],12227]},{"":[4,"d",[174,273],12244]},{"":[4,"d",[144,273],12261]},{"":[4,"d",[132,273],12278]},{"":[4,"d",[130,274],12311]},{"":[4,"d",[129,275],12328]},{"":[4,"d",[128,275],12345]},{"":[4,"d",[128,278],12384]},{"":[4,"d",[128,280],12401]},{"":[4,"d",[145,290],12417]},{"":[4,"d",[181,302],12434]},{"":[4,"d",[227,321],12451]},{"":[4,"d",[268,334],12468]},{"":[4,"d",[304,346],12485]},{"":[4,"d",[323,351],12501]},{"":[4,"d",[337,353],12518]},{"":[4,"d",[342,353],12534]},{"":[4,"d",[347,349],12551]},{"":[4,"d",[359,339],12568]},{"":[4,"d",[371,331],12584]},{"":[4,"d",[383,322],12601]},{"":[4,"d",[391,312],12618]},{"":[4,"d",[400,299],12634]},{"":[4,"d",[411,278],12651]},{"":[4,"d",[418,257],12668]},{"":[4,"d",[425,237],12684]},{"":[4,"d",[429,222],12701]},{"":[4,"d",[433,208],12717]},{"":[4,"d",[434,199],12735]},{"":[4,"d",[434,184],12751]},{"":[4,"d",[434,166],12780]},{"":[4,"d",[430,146],12796]},{"":[4,"d",[427,133],12813]},{"":[4,"d",[425,122],12830]},{"":[4,"d",[425,108],12847]},{"":[4,"d",[425,90],12863]},{"":[4,"d",[425,69],12880]},{"":[4,"d",[425,50],12897]},{"":[4,"d",[423,41],12913]},{"":[4,"d",[419,39],12930]},{"":[4,"d",[418,39],12952]},{"":[4,"d",[411,39],12968]},{"":[4,"d",[392,41],12985]},{"":[4,"d",[366,41],13001]},{"":[4,"d",[329,41],13018]},{"":[4,"d",[282,40],13047]},{"":[4,"d",[218,41],13064]},{"":[4,"d",[155,43],13080]},{"":[4,"d",[120,45],13084]},{"":[4,"d",[106,46],13114]},{"":[4,"d",[97,46],13118]},{"":[4,"d",[92,46],13146]},{"":[4,"d",[84,46],13164]},{"":[4,"d",[81,46],13181]},{"":[4,"d",[86,47],13201]},{"":[4,"d",[96,50],13218]},{"":[4,"d",[143,61],13235]},{"":[4,"d",[219,74],13251]},{"":[4,"d",[295,88],13268]},{"":[4,"d",[325,94],13298]},{"":[4,"d",[355,98],13301]},{"":[4,"d",[363,100],13331]},{"":[4,"d",[367,101],13335]},{"":[4,"d",[368,101],13365]},{"":[4,"d",[353,102],13401]},{"":[4,"d",[318,102],13418]},{"":[4,"d",[236,102],13435]},{"":[4,"d",[160,107],13452]},{"":[4,"d",[120,111],13469]},{"":[4,"d",[105,111],13485]},{"":[4,"d",[113,111],13552]},{"":[4,"d",[152,113],13569]},{"":[4,"d",[249,124],13585]},{"":[4,"d",[361,136],13602]},{"":[4,"d",[443,145],13618]},{"":[4,"d",[474,150],13636]},{"":[4,"d",[477,151],13669]},{"":[4,"d",[473,152],13685]},{"":[4,"d",[457,158],13702]},{"":[4,"d",[439,166],13718]},{"":[4,"d",[409,182],13735]},{"":[4,"d",[358,204],13752]},{"":[4,"d",[302,232],13768]},{"":[4,"d",[255,243],13785]},{"":[4,"d",[224,250],13802]},{"":[4,"d",[219,251],13818]},{"":[4,"d",[221,251],13869]},{"":[4,"d",[222,252],13885]},{"":[4,"d",[238,257],13902]},{"":[4,"d",[280,262],13919]},{"":[4,"d",[339,272],13935]},{"":[4,"d",[376,281],13952]},{"":[4,"d",[382,284],13969]},{"":[4,"d",[383,285],13985]},{"":[4,"d",[379,286],14002]},{"":[4,"d",[356,290],14019]},{"":[4,"d",[321,295],14035]},{"":[4,"d",[231,302],14052]},{"":[4,"d",[178,310],14069]},{"":[4,"d",[146,315],14085]},{"":[4,"d",[137,316],14102]},{"":[4,"d",[138,317],14169]},{"":[4,"d",[140,317],14185]},{"":[4,"d",[145,317],14202]},{"":[2,"c",14208]},{"":[5,[507,100],"b",15216]},{"":[4,"d",[507,104],15217]},{"":[4,"d",[504,118],15234]},{"":[4,"d",[492,160],15250]},{"":[4,"d",[485,217],15266]},{"":[4,"d",[479,275],15284]},{"":[4,"d",[470,333],15301]},{"":[4,"d",[469,377],15317]},{"":[2,"c",15334]},{"":[5,[541,91],"b",15977]},{"":[4,"d",[543,75],15987]},{"":[4,"d",[543,65],16001]},{"":[4,"d",[542,55],16018]},{"":[4,"d",[539,44],16035]},{"":[4,"d",[531,28],16056]},{"":[4,"d",[515,8],16073]},{"":[2,"c",16090]},{"":[5,[515,226],"b",16617]},{"":[4,"d",[526,221],16619]},{"":[4,"d",[531,216],16634]},{"":[4,"d",[531,214],16655]},{"":[4,"d",[527,210],16677]},{"":[4,"d",[516,210],16693]},{"":[4,"d",[502,210],16710]},{"":[4,"d",[491,211],16727]},{"":[4,"d",[482,214],16743]},{"":[4,"d",[470,220],16760]},{"":[4,"d",[457,229],16777]},{"":[4,"d",[445,243],16794]},{"":[4,"d",[440,250],16811]},{"":[4,"d",[438,253],16827]},{"":[2,"c",16877]},{"":[3,"s","rgb(255, 102, 0)",18651]},{"":[3,"s","rgb(255, 102, 0)",18651]},{"":[5,[504,129],"b",18760]},{"":[4,"d",[497,130],18771]},{"":[4,"d",[486,133],18795]},{"":[4,"d",[477,135],18811]},{"":[4,"d",[471,138],18824]},{"":[4,"d",[459,145],18841]},{"":[4,"d",[425,156],18857]},{"":[4,"d",[377,169],18875]},{"":[4,"d",[357,173],18891]},{"":[4,"d",[325,183],18908]},{"":[4,"d",[310,194],18924]},{"":[4,"d",[301,201],18941]},{"":[4,"d",[300,207],18958]},{"":[4,"d",[298,212],18974]},{"":[4,"d",[298,218],18992]},{"":[4,"d",[296,225],19009]},{"":[4,"d",[294,237],19025]},{"":[4,"d",[289,252],19041]},{"":[4,"d",[286,263],19057]},{"":[4,"d",[282,280],19075]},{"":[4,"d",[278,288],19092]},{"":[4,"d",[273,295],19108]},{"":[4,"d",[265,306],19125]},{"":[4,"d",[250,318],19142]},{"":[4,"d",[238,327],19159]},{"":[4,"d",[226,330],19175]},{"":[4,"d",[215,330],19192]},{"":[4,"d",[200,327],19209]},{"":[4,"d",[179,318],19225]},{"":[4,"d",[165,307],19242]},{"":[4,"d",[158,295],19258]},{"":[4,"d",[151,282],19275]},{"":[4,"d",[143,264],19292]},{"":[4,"d",[139,253],19309]},{"":[4,"d",[138,245],19325]},{"":[4,"d",[138,238],19341]},{"":[4,"d",[142,230],19358]},{"":[4,"d",[155,222],19375]},{"":[4,"d",[176,214],19391]},{"":[4,"d",[189,213],19409]},{"":[4,"d",[202,213],19425]},{"":[4,"d",[213,219],19442]},{"":[4,"d",[218,225],19459]},{"":[4,"d",[220,238],19475]},{"":[4,"d",[224,254],19492]},{"":[4,"d",[230,272],19509]},{"":[4,"d",[241,285],19525]},{"":[4,"d",[262,293],19543]},{"":[4,"d",[285,297],19559]},{"":[4,"d",[310,297],19576]},{"":[4,"d",[337,293],19593]},{"":[4,"d",[372,287],19606]},{"":[4,"d",[397,281],19623]},{"":[4,"d",[420,276],19640]},{"":[4,"d",[439,270],19657]},{"":[4,"d",[450,267],19674]},{"":[4,"d",[458,262],19689]},{"":[4,"d",[463,254],19706]},{"":[4,"d",[468,246],19723]},{"":[4,"d",[471,236],19740]},{"":[4,"d",[472,228],19757]},{"":[4,"d",[476,219],19773]},{"":[4,"d",[476,210],19790]},{"":[4,"d",[475,191],19807]},{"":[4,"d",[468,171],19825]},{"":[4,"d",[455,154],19840]},{"":[4,"d",[435,135],19857]},{"":[4,"d",[411,120],19873]},{"":[4,"d",[390,110],19890]},{"":[4,"d",[376,103],19907]},{"":[4,"d",[364,99],19924]},{"":[4,"d",[354,97],19939]},{"":[4,"d",[348,96],19957]},{"":[4,"d",[338,95],19973]},{"":[4,"d",[329,94],19990]},{"":[4,"d",[320,94],20007]},{"":[4,"d",[312,94],20024]},{"":[4,"d",[307,94],20040]},{"":[4,"d",[299,95],20057]},{"":[4,"d",[293,98],20074]},{"":[4,"d",[286,102],20090]},{"":[4,"d",[280,107],20107]},{"":[4,"d",[273,110],20123]},{"":[4,"d",[268,114],20140]},{"":[4,"d",[263,115],20158]},{"":[4,"d",[257,115],20176]},{"":[4,"d",[249,115],20191]},{"":[4,"d",[241,115],20207]},{"":[4,"d",[233,115],20224]},{"":[4,"d",[227,116],20240]},{"":[4,"d",[223,119],20257]},{"":[4,"d",[219,123],20274]},{"":[4,"d",[213,132],20291]},{"":[4,"d",[207,147],20307]},{"":[4,"d",[205,172],20323]},{"":[4,"d",[210,205],20341]},{"":[4,"d",[234,228],20358]},{"":[4,"d",[261,240],20374]},{"":[4,"d",[283,243],20391]},{"":[4,"d",[296,245],20407]},{"":[4,"d",[298,246],20424]},{"":[4,"d",[299,247],20440]},{"":[4,"d",[299,254],20458]},{"":[4,"d",[304,264],20474]},{"":[4,"d",[317,274],20491]},{"":[4,"d",[328,283],20507]},{"":[4,"d",[345,290],20524]},{"":[4,"d",[352,293],20541]},{"":[4,"d",[355,296],20557]},{"":[4,"d",[359,302],20574]},{"":[4,"d",[362,307],20591]},{"":[4,"d",[367,310],20608]},{"":[4,"d",[369,312],20624]},{"":[4,"d",[370,313],20684]},{"":[4,"d",[369,314],20701]},{"":[4,"d",[365,315],20718]},{"":[4,"d",[347,315],20735]},{"":[4,"d",[322,317],20751]},{"":[4,"d",[297,320],20768]},{"":[4,"d",[283,320],20785]},{"":[4,"d",[272,320],20801]},{"":[4,"d",[266,320],20818]},{"":[4,"d",[264,320],20841]},{"":[4,"d",[262,320],20857]},{"":[4,"d",[261,320],20873]},{"":[2,"c",20912]},{"":[3,"s","rgb(0, 128, 128)",21458]},{"":[5,[347,370],"b",21866]},{"":[4,"d",[346,370],21890]},{"":[4,"d",[344,370],21904]},{"":[4,"d",[334,372],21932]},{"":[4,"d",[323,373],21951]},{"":[4,"d",[301,373],21953]},{"":[4,"d",[281,374],21969]},{"":[4,"d",[259,375],21990]},{"":[4,"d",[241,375],22009]},{"":[4,"d",[229,371],22024]},{"":[4,"d",[223,365],22041]},{"":[4,"d",[218,358],22056]},{"":[4,"d",[216,351],22073]},{"":[4,"d",[215,349],22090]},{"":[4,"d",[214,345],22109]},{"":[4,"d",[210,334],22141]},{"":[4,"d",[209,329],22158]},{"":[4,"d",[209,328],22190]},{"":[4,"d",[209,328],22266]},{"":[4,"d",[209,326],22282]},{"":[4,"d",[209,324],22299]},{"":[4,"d",[206,320],22316]},{"":[4,"d",[199,317],22333]},{"":[4,"d",[189,317],22349]},{"":[4,"d",[174,317],22366]},{"":[4,"d",[165,317],22382]},{"":[4,"d",[157,318],22399]},{"":[4,"d",[154,320],22416]},{"":[4,"d",[153,322],22432]},{"":[4,"d",[153,328],22449]},{"":[4,"d",[153,331],22467]},{"":[4,"d",[152,332],22500]},{"":[2,"c",22508]},{"":[5,[139,346],"b",22705]},{"":[4,"d",[138,347],22716]},{"":[4,"d",[137,350],22748]},{"":[4,"d",[137,354],22750]},{"":[4,"d",[137,358],22774]},{"":[4,"d",[137,360],22796]},{"":[4,"d",[138,363],22805]},{"":[4,"d",[148,366],22821]},{"":[4,"d",[162,367],22838]},{"":[4,"d",[173,367],22855]},{"":[4,"d",[179,366],22871]},{"":[4,"d",[179,365],22900]},{"":[4,"d",[179,364],22917]},{"":[4,"d",[172,363],22933]},{"":[4,"d",[157,361],22952]},{"":[4,"d",[128,357],22967]},{"":[4,"d",[95,349],22989]},{"":[4,"d",[80,344],23005]},{"":[4,"d",[73,339],23022]},{"":[4,"d",[71,334],23038]},{"":[4,"d",[71,326],23065]},{"":[4,"d",[72,320],23066]},{"":[4,"d",[74,312],23088]},{"":[4,"d",[76,302],23105]},{"":[4,"d",[78,290],23122]},{"":[4,"d",[81,280],23139]},{"":[4,"d",[83,272],23155]},{"":[4,"d",[84,268],23172]},{"":[2,"c",23174]},{"":[5,[55,186],"b",23497]},{"":[4,"d",[51,192],23501]},{"":[4,"d",[49,198],23517]},{"":[4,"d",[47,209],23533]},{"":[4,"d",[47,217],23558]},{"":[4,"d",[53,230],23566]},{"":[4,"d",[62,240],23584]},{"":[4,"d",[79,250],23600]},{"":[4,"d",[88,257],23617]},{"":[4,"d",[89,259],23633]},{"":[4,"d",[89,261],23650]},{"":[4,"d",[87,265],23667]},{"":[4,"d",[82,270],23684]},{"":[4,"d",[80,273],23700]},{"":[4,"d",[79,275],23717]},{"":[4,"d",[78,278],23739]},{"":[4,"d",[76,281],23756]},{"":[4,"d",[74,285],23772]},{"":[4,"d",[73,295],23789]},{"":[4,"d",[73,304],23807]},{"":[4,"d",[75,312],23822]},{"":[2,"c",23842]},{"":[5,[362,324],"b",24042]},{"":[4,"d",[366,324],24053]},{"":[4,"d",[379,324],24078]},{"":[4,"d",[390,324],24085]},{"":[4,"d",[409,324],24101]},{"":[4,"d",[429,322],24117]},{"":[4,"d",[453,318],24134]},{"":[4,"d",[470,315],24151]},{"":[4,"d",[490,313],24168]},{"":[4,"d",[509,313],24184]},{"":[4,"d",[523,313],24201]},{"":[4,"d",[530,311],24217]},{"":[4,"d",[533,310],24234]},{"":[4,"d",[535,308],24260]},{"":[4,"d",[536,308],24276]},{"":[4,"d",[539,307],24293]},{"":[4,"d",[542,305],24309]},{"":[4,"d",[545,301],24327]},{"":[4,"d",[550,295],24343]},{"":[4,"d",[553,282],24360]},{"":[4,"d",[554,266],24377]},{"":[4,"d",[554,249],24393]},{"":[4,"d",[550,239],24410]},{"":[4,"d",[547,231],24427]},{"":[4,"d",[543,222],24443]},{"":[4,"d",[542,216],24460]},{"":[4,"d",[541,211],24477]},{"":[4,"d",[539,203],24494]},{"":[4,"d",[538,198],24510]},{"":[4,"d",[536,193],24527]},{"":[4,"d",[534,185],24544]},{"":[4,"d",[530,173],24560]},{"":[4,"d",[527,166],24578]},{"":[4,"d",[525,160],24595]},{"":[4,"d",[523,155],24611]},{"":[4,"d",[519,150],24628]},{"":[4,"d",[517,146],24645]},{"":[4,"d",[515,141],24658]},{"":[4,"d",[514,137],24678]},{"":[4,"d",[514,135],24694]},{"":[4,"d",[514,133],24711]},{"":[4,"d",[514,131],24728]},{"":[4,"d",[513,130],24745]},{"":[4,"d",[513,128],24762]},{"":[4,"d",[513,124],24778]},{"":[4,"d",[513,120],24795]},{"":[4,"d",[511,118],24812]},{"":[4,"d",[510,113],24829]},{"":[4,"d",[506,109],24845]},{"":[4,"d",[503,106],24862]},{"":[4,"d",[502,106],24879]},{"":[4,"d",[501,105],24895]},{"":[4,"d",[495,101],24913]},{"":[4,"d",[491,98],24929]},{"":[4,"d",[489,97],24946]},{"":[4,"d",[489,96],24963]},{"":[4,"d",[488,96],24979]},{"":[4,"d",[485,94],24996]},{"":[4,"d",[475,91],25013]},{"":[4,"d",[464,89],25029]},{"":[4,"d",[452,89],25046]},{"":[4,"d",[435,89],25066]},{"":[4,"d",[418,90],25080]},{"":[4,"d",[399,97],25096]},{"":[4,"d",[374,107],25113]},{"":[4,"d",[351,121],25130]},{"":[4,"d",[338,132],25147]},{"":[4,"d",[331,141],25165]},{"":[4,"d",[320,156],25179]},{"":[4,"d",[314,168],25194]},{"":[4,"d",[311,178],25213]},{"":[4,"d",[308,183],25230]},{"":[4,"d",[307,191],25247]},{"":[4,"d",[304,196],25264]},{"":[4,"d",[304,200],25280]},{"":[4,"d",[303,202],25297]},{"":[4,"d",[303,205],25314]},{"":[4,"d",[301,208],25331]},{"":[4,"d",[300,212],25347]},{"":[4,"d",[299,215],25364]},{"":[4,"d",[297,221],25381]},{"":[4,"d",[294,226],25397]},{"":[4,"d",[293,228],25414]},{"":[4,"d",[290,232],25431]},{"":[4,"d",[287,233],25448]},{"":[4,"d",[285,234],25465]},{"":[4,"d",[283,234],25481]},{"":[4,"d",[281,234],25498]},{"":[4,"d",[280,234],25515]},{"":[4,"d",[279,235],25531]},{"":[2,"c",25549]},{"":[5,[384,180],"b",25947]},{"":[4,"d",[385,184],25956]},{"":[4,"d",[385,188],25968]},{"":[4,"d",[385,193],25985]},{"":[4,"d",[385,200],26004]},{"":[4,"d",[385,212],26022]},{"":[4,"d",[384,222],26040]},{"":[4,"d",[383,233],26057]},{"":[4,"d",[382,243],26074]},{"":[4,"d",[381,248],26090]},{"":[4,"d",[381,252],26107]},{"":[4,"d",[381,256],26124]},{"":[4,"d",[381,257],26140]},{"":[2,"c",26174]},{"":[5,[173,77],"b",26777]},{"":[4,"d",[164,81],26787]},{"":[4,"d",[157,85],26807]},{"":[4,"d",[140,93],26835]},{"":[4,"d",[123,106],26836]},{"":[4,"d",[111,119],26858]},{"":[4,"d",[107,125],26874]},{"":[4,"d",[104,131],26891]},{"":[4,"d",[105,136],26908]},{"":[4,"d",[114,143],26924]},{"":[4,"d",[135,149],26941]},{"":[4,"d",[158,154],26957]},{"":[4,"d",[183,157],26974]},{"":[4,"d",[202,162],26991]},{"":[4,"d",[212,165],27007]},{"":[4,"d",[214,168],27025]},{"":[4,"d",[213,171],27041]},{"":[4,"d",[201,183],27057]},{"":[4,"d",[168,211],27075]},{"":[4,"d",[127,246],27091]},{"":[4,"d",[101,268],27107]},{"":[4,"d",[85,280],27125]},{"":[4,"d",[82,285],27142]},{"":[4,"d",[84,287],27158]},{"":[4,"d",[102,287],27176]},{"":[4,"d",[140,287],27195]},{"":[4,"d",[197,279],27208]},{"":[4,"d",[249,271],27222]},{"":[4,"d",[296,267],27238]},{"":[4,"d",[324,265],27256]},{"":[4,"d",[326,265],27273]},{"":[4,"d",[325,266],27290]},{"":[4,"d",[319,269],27306]},{"":[4,"d",[294,283],27323]},{"":[4,"d",[273,292],27339]},{"":[4,"d",[263,298],27356]},{"":[4,"d",[269,294],27388]},{"":[4,"d",[287,284],27406]},{"":[4,"d",[323,259],27422]},{"":[4,"d",[365,229],27438]},{"":[4,"d",[389,202],27456]},{"":[4,"d",[400,186],27472]},{"":[4,"d",[400,178],27489]},{"":[4,"d",[381,166],27507]},{"":[4,"d",[347,160],27522]},{"":[4,"d",[295,150],27539]},{"":[4,"d",[238,147],27556]},{"":[4,"d",[191,149],27572]},{"":[4,"d",[177,154],27589]},{"":[4,"d",[177,155],27606]},{"":[4,"d",[179,155],27622]},{"":[4,"d",[202,149],27639]},{"":[4,"d",[224,141],27655]},{"":[4,"d",[242,126],27672]},{"":[4,"d",[252,113],27689]},{"":[4,"d",[256,104],27706]},{"":[4,"d",[257,99],27722]},{"":[4,"d",[255,96],27739]},{"":[4,"d",[250,94],27756]},{"":[4,"d",[240,94],27774]},{"":[4,"d",[223,100],27790]},{"":[4,"d",[200,109],27806]},{"":[4,"d",[180,125],27822]},{"":[4,"d",[174,135],27840]},{"":[4,"d",[179,139],27856]},{"":[4,"d",[206,141],27872]},{"":[4,"d",[253,134],27890]},{"":[4,"d",[292,121],27906]},{"":[4,"d",[309,112],27923]},{"":[4,"d",[315,107],27939]},{"":[4,"d",[315,106],27956]},{"":[4,"d",[313,106],27973]},{"":[4,"d",[294,106],27989]},{"":[4,"d",[275,116],28007]},{"":[4,"d",[249,140],28025]},{"":[4,"d",[235,161],28040]},{"":[4,"d",[231,170],28056]},{"":[4,"d",[231,172],28073]},{"":[4,"d",[233,174],28091]},{"":[4,"d",[247,175],28107]},{"":[4,"d",[280,173],28123]},{"":[4,"d",[316,159],28140]},{"":[4,"d",[343,142],28156]},{"":[4,"d",[371,113],28173]},{"":[4,"d",[387,85],28190]},{"":[4,"d",[390,72],28207]},{"":[4,"d",[387,63],28223]},{"":[4,"d",[364,60],28240]},{"":[4,"d",[325,61],28257]},{"":[4,"d",[282,75],28273]},{"":[4,"d",[236,99],28291]},{"":[4,"d",[195,131],28307]},{"":[4,"d",[178,158],28324]},{"":[4,"d",[178,170],28342]},{"":[4,"d",[189,174],28360]},{"":[4,"d",[236,174],28374]},{"":[4,"d",[283,165],28391]},{"":[4,"d",[314,148],28409]},{"":[4,"d",[321,136],28425]},{"":[4,"d",[321,125],28441]},{"":[4,"d",[306,115],28458]},{"":[4,"d",[290,108],28475]},{"":[4,"d",[265,108],28491]},{"":[4,"d",[238,109],28508]},{"":[4,"d",[221,118],28524]},{"":[4,"d",[213,127],28543]},{"":[4,"d",[209,135],28557]},{"":[4,"d",[209,143],28575]},{"":[4,"d",[209,147],28593]},{"":[4,"d",[210,153],28608]},{"":[4,"d",[216,159],28625]},{"":[4,"d",[225,166],28641]},{"":[4,"d",[233,170],28657]},{"":[2,"c",28660]},{"":[5,[296,195],"b",28786]},{"":[4,"d",[302,195],28786]},{"":[4,"d",[305,197],28802]},{"":[4,"d",[307,204],28818]},{"":[4,"d",[308,210],28843]},{"":[4,"d",[312,221],28852]},{"":[4,"d",[319,235],28869]},{"":[4,"d",[325,244],28885]},{"":[4,"d",[328,246],28902]},{"":[4,"d",[330,248],28918]},{"":[4,"d",[332,249],28935]},{"":[4,"d",[334,249],28951]},{"":[4,"d",[334,250],28985]},{"":[4,"d",[322,253],29001]},{"":[4,"d",[282,259],29018]},{"":[4,"d",[219,260],29035]},{"":[4,"d",[155,260],29052]},{"":[4,"d",[96,252],29069]},{"":[4,"d",[87,249],29085]},{"":[4,"d",[87,243],29103]},{"":[4,"d",[95,221],29119]},{"":[4,"d",[112,200],29135]},{"":[4,"d",[127,183],29152]},{"":[4,"d",[143,167],29169]},{"":[4,"d",[162,154],29185]},{"":[4,"d",[194,134],29202]},{"":[4,"d",[223,113],29219]},{"":[4,"d",[247,93],29236]},{"":[4,"d",[263,82],29252]},{"":[4,"d",[272,80],29269]},{"":[4,"d",[273,82],29285]},{"":[4,"d",[273,86],29302]},{"":[4,"d",[273,98],29319]},{"":[4,"d",[268,128],29336]},{"":[4,"d",[264,162],29352]},{"":[4,"d",[263,181],29369]},{"":[4,"d",[267,192],29386]},{"":[4,"d",[277,195],29402]},{"":[4,"d",[289,196],29419]},{"":[4,"d",[306,191],29435]},{"":[4,"d",[325,173],29452]},{"":[4,"d",[337,153],29469]},{"":[4,"d",[340,136],29485]},{"":[4,"d",[338,120],29501]},{"":[4,"d",[328,107],29519]},{"":[4,"d",[312,97],29545]},{"":[4,"d",[279,92],29561]},{"":[4,"d",[239,92],29578]},{"":[4,"d",[201,111],29596]},{"":[4,"d",[171,131],29609]},{"":[4,"d",[158,146],29628]},{"":[4,"d",[152,158],29645]},{"":[4,"d",[152,168],29662]},{"":[4,"d",[157,182],29679]},{"":[4,"d",[171,193],29695]},{"":[4,"d",[199,205],29712]},{"":[4,"d",[220,210],29729]},{"":[4,"d",[248,212],29745]},{"":[4,"d",[257,212],29762]},{"":[4,"d",[266,213],29779]},{"":[4,"d",[273,215],29796]},{"":[4,"d",[276,215],29813]},{"":[4,"d",[276,216],29829]},{"":[4,"d",[277,219],29846]},{"":[4,"d",[278,223],29863]},{"":[4,"d",[280,232],29879]},{"":[4,"d",[283,249],29896]},{"":[4,"d",[286,258],29913]},{"":[4,"d",[292,264],29929]},{"":[4,"d",[294,265],29946]},{"":[4,"d",[296,267],29963]},{"":[4,"d",[300,268],29980]},{"":[4,"d",[308,272],29997]},{"":[4,"d",[319,277],30013]},{"":[4,"d",[344,277],30031]},{"":[4,"d",[364,275],30047]},{"":[4,"d",[378,269],30064]},{"":[4,"d",[390,259],30081]},{"":[4,"d",[397,247],30098]},{"":[4,"d",[401,233],30115]},{"":[4,"d",[402,213],30129]},{"":[4,"d",[402,193],30148]},{"":[4,"d",[398,169],30164]},{"":[4,"d",[384,146],30181]},{"":[4,"d",[348,114],30197]},{"":[4,"d",[305,103],30215]},{"":[4,"d",[286,104],30231]},{"":[4,"d",[275,109],30248]},{"":[4,"d",[271,117],30265]},{"":[4,"d",[270,130],30281]},{"":[4,"d",[270,144],30298]},{"":[2,"c",30315]},{"":[5,[360,337],"b",31316]},{"":[4,"d",[355,337],31368]},{"":[4,"d",[345,341],31385]},{"":[4,"d",[326,348],31402]},{"":[4,"d",[313,358],31419]},{"":[4,"d",[304,365],31435]},{"":[4,"d",[301,370],31452]},{"":[4,"d",[301,376],31468]},{"":[4,"d",[301,381],31485]},{"":[4,"d",[302,383],31502]},{"":[4,"d",[307,385],31518]},{"":[4,"d",[319,385],31535]},{"":[4,"d",[331,383],31552]},{"":[4,"d",[341,377],31568]},{"":[4,"d",[346,370],31585]},{"":[4,"d",[350,364],31602]},{"":[4,"d",[350,361],31624]},{"":[4,"d",[349,362],31652]},{"":[4,"d",[349,364],31668]},{"":[4,"d",[348,371],31685]},{"":[4,"d",[353,377],31703]},{"":[4,"d",[363,380],31719]},{"":[4,"d",[379,381],31735]},{"":[4,"d",[394,378],31753]},{"":[4,"d",[409,374],31769]},{"":[4,"d",[419,369],31786]},{"":[4,"d",[433,365],31803]},{"":[4,"d",[440,363],31819]},{"":[4,"d",[443,363],31835]},{"":[4,"d",[445,363],31852]},{"":[4,"d",[448,364],31875]},{"":[4,"d",[450,364],31891]},{"":[4,"d",[452,364],31953]},{"":[4,"d",[458,364],31970]},{"":[4,"d",[465,363],31985]},{"":[4,"d",[476,360],32002]},{"":[4,"d",[490,352],32018]},{"":[4,"d",[497,345],32035]},{"":[4,"d",[500,334],32052]},{"":[4,"d",[500,322],32069]},{"":[4,"d",[500,311],32086]},{"":[4,"d",[500,308],32102]},{"":[4,"d",[499,307],32136]},{"":[4,"d",[499,308],32152]},{"":[4,"d",[500,308],32220]},{"":[4,"d",[505,303],32235]},{"":[4,"d",[511,295],32253]},{"":[4,"d",[516,287],32269]},{"":[4,"d",[517,279],32285]},{"":[4,"d",[518,272],32302]},{"":[4,"d",[518,269],32319]},{"":[4,"d",[518,264],32335]},{"":[4,"d",[515,258],32352]},{"":[4,"d",[507,249],32369]},{"":[4,"d",[495,241],32386]},{"":[4,"d",[490,234],32402]},{"":[4,"d",[489,232],32419]},{"":[4,"d",[491,225],32437]},{"":[4,"d",[499,218],32452]},{"":[2,"c",32461]},{"":[5,[545,145],"b",32884]},{"":[4,"d",[542,148],32887]},{"":[4,"d",[540,149],32914]},{"":[4,"d",[536,152],32920]},{"":[4,"d",[531,155],32941]},{"":[4,"d",[523,160],32968]},{"":[4,"d",[518,166],32970]},{"":[4,"d",[517,169],32997]},{"":[4,"d",[515,172],33013]},{"":[4,"d",[515,175],33030]},{"":[4,"d",[515,180],33047]},{"":[4,"d",[515,189],33064]},{"":[4,"d",[515,197],33080]},{"":[4,"d",[515,209],33097]},{"":[4,"d",[515,218],33114]},{"":[4,"d",[515,229],33131]},{"":[4,"d",[515,238],33147]},{"":[4,"d",[512,246],33164]},{"":[4,"d",[510,256],33182]},{"":[4,"d",[505,265],33196]},{"":[4,"d",[495,280],33214]},{"":[4,"d",[482,293],33228]},{"":[4,"d",[468,306],33248]},{"":[4,"d",[448,316],33264]},{"":[4,"d",[428,323],33281]},{"":[4,"d",[414,332],33298]},{"":[4,"d",[392,340],33315]},{"":[4,"d",[378,346],33332]},{"":[4,"d",[373,348],33348]},{"":[4,"d",[367,348],33365]},{"":[4,"d",[362,348],33382]},{"":[4,"d",[353,346],33398]},{"":[4,"d",[344,343],33432]},{"":[4,"d",[333,337],33448]},{"":[4,"d",[321,330],33465]},{"":[4,"d",[309,318],33482]},{"":[4,"d",[296,302],33499]},{"":[4,"d",[285,282],33515]},{"":[4,"d",[280,266],33532]},{"":[4,"d",[274,250],33549]},{"":[4,"d",[265,230],33565]},{"":[4,"d",[257,211],33582]},{"":[4,"d",[244,184],33599]},{"":[4,"d",[232,164],33616]},{"":[4,"d",[225,151],33633]},{"":[4,"d",[219,145],33649]},{"":[4,"d",[216,142],33667]},{"":[4,"d",[210,138],33683]},{"":[4,"d",[203,133],33697]},{"":[4,"d",[196,129],33716]},{"":[4,"d",[190,125],33733]},{"":[4,"d",[182,122],33750]},{"":[4,"d",[178,120],33766]},{"":[4,"d",[175,118],33783]},{"":[4,"d",[169,115],33800]},{"":[4,"d",[159,109],33816]},{"":[4,"d",[150,105],33833]},{"":[4,"d",[142,102],33850]},{"":[4,"d",[132,102],33867]},{"":[4,"d",[124,102],33884]},{"":[4,"d",[115,102],33901]},{"":[4,"d",[105,103],33917]},{"":[4,"d",[98,106],33934]},{"":[4,"d",[93,111],33951]},{"":[4,"d",[89,118],33967]},{"":[4,"d",[87,130],33984]},{"":[4,"d",[85,145],34001]},{"":[4,"d",[85,156],34018]},{"":[4,"d",[84,167],34035]},{"":[4,"d",[84,175],34052]},{"":[4,"d",[84,182],34068]},{"":[4,"d",[84,187],34086]},{"":[4,"d",[84,194],34102]},{"":[4,"d",[84,204],34118]},{"":[4,"d",[88,222],34151]},{"":[4,"d",[91,230],34168]},{"":[4,"d",[93,236],34185]},{"":[4,"d",[98,242],34199]},{"":[4,"d",[103,246],34218]},{"":[4,"d",[111,253],34234]},{"":[4,"d",[119,261],34251]},{"":[4,"d",[129,268],34268]},{"":[4,"d",[140,273],34285]},{"":[4,"d",[148,279],34302]},{"":[4,"d",[153,282],34319]},{"":[4,"d",[158,284],34335]},{"":[4,"d",[162,287],34352]},{"":[4,"d",[165,289],34355]},{"":[4,"d",[168,292],34385]},{"":[2,"c",34403]}]]}}';
      }
      storedData = lzw_encode(storedData);
      var data = CJSON.parse(lzw_decode(storedData));
      XBUI.setMaxTime(data["recordingTime"]);
      XB.recordingTime = data["recordingTime"];
      XB.subtractTime = data["subtractTime"];
      XB.lastEndTime = data["lastEndTime"];
      $.fn.colorPicker.changeColor(data["strokeColor"]);
      XB.events = data["events"];
    },

    /* Generates an 11 character unique ID for this video */
    genUniqueID: function() {
      var chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
      var len = 11;
      var id = "";
      var rand_no;
      for (var i = 0; i < len; i++){
        rand = Math.floor(Math.random() * chars.length);
        id += chars.substring(rand, rand + 1);
      }
      return id;
    },

    /* calls set clock every x milliseconds for when playing back
       need to use this instead of getRecordingTime since events
       don't happen in regular intervals so we need a regular clock update */
    setPlaybackClock: function(time){
      if (typeof time === "undefined") {
        // if no explicit time passed in, increment the current playbackClock
        XB.playbackClock += XB.sampleRate;
      } else {
        XB.playbackClock = time;
      }

      XBUI.setClock(XB.playbackClock);

      // set timeout if we're in play mode
      if (XB.isPlaying) {
        // to make sure we stop at the end of playback
        if (XB.playbackClock < XB.getRecordingTime()) {
          XB.playbackClockTimeout = setTimeout(XB.setPlaybackClock, XB.sampleRate, XB.playbackClock + XB.sampleRate);
        } else {
          XB.isPlaying = false;
          XB.playbackClock = XB.getRecordingTime();
          XBUI.playPauseToggle();
        }
      }

    },

    /* Gets the time elapsed in recording mode*/
    getRecordingTime: function(){
      if (XB.recording) {
        XB.recordingTime = new Date().getTime() - XB.subtractTime;
      }
      return XB.recordingTime;
    },

    // check if playback is at max time
    playbackEnd: function(){
      return XB.playbackClock == XB.getRecordingTime();
    },

    // check if all events have been played in playback
    eventsEnd: function() {
      return XB.animIndex == (XB.events.length - 1);
    },

    };
})();
